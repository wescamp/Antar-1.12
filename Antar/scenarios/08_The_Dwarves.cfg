#textdomain wesnoth-Antar

# New Changes Line 756 [filter_condition] [have_unit]]

#define INITIALIZE_SCENARIO_VARIABLES
	{VARIABLE generator_on         yes}
	{VARIABLE undead_sighted         0}
	{VARIABLE wizard_status          0}
	{VARIABLE gomdring_found        no}
	{VARIABLE undead_meet            0}
	{VARIABLE count_Antars_men       0}
	{VARIABLE hidden_entrance_found no}
	{VARIABLE hint                  no}
	{VARIABLE hint_spoken           no}
	{VARIABLE moveto_count           0}
	{VARIABLE antar_in_the_mines    no}
	{VARIABLE ugoshag_meet          no}
#ifdef EASY
	{VARIABLE set_new_turns 22}   # set remaining turns / 22 in this case 
#endif
#ifdef NORMAL
	{VARIABLE set_new_turns 19}
#endif
#ifdef HARD
	{VARIABLE set_new_turns 17}
#endif
#enddef
#define CLEAR_SCENARIO_VARIABLES
	{CLEAR_VARIABLE generator_on}                       ### generating undead
	{CLEAR_VARIABLE undead_sighted}
	{CLEAR_VARIABLE wizard_status}                      ### Gomdrings talking at the end depends on whether the Wizard is alive or not
	{CLEAR_VARIABLE random}                             ### generating undead random type
	{CLEAR_VARIABLE set_new_turns}                      ### add $ turns after finding Gomdring
	{CLEAR_VARIABLE gomdring_found}                     ### check if Antar or soldier discovers Gomdring
	{CLEAR_VARIABLE undead_meet}                        ### to share enemy's view
	{CLEAR_VARIABLE count_Antars_men}                   ### to count Antars men at start
	{CLEAR_VARIABLE hidden_entrance_found}              ### hint message makes only sense when entrance undiscovered
	{CLEAR_VARIABLE warden}                             ### messager when sombody stumbles upon noach
	{CLEAR_VARIABLE gomdrings_visitor}                    ### throneroomguard
	{CLEAR_VARIABLE temp_x1}                            ### throneroomguard
	{CLEAR_VARIABLE temp_x2}                            ### throneroomguard
	{CLEAR_VARIABLE temp_y}                             ### throneroomguard
	{CLEAR_VARIABLE unit_found_cave}                    ### max movepoints for the unit whos fount the hidden entrance
	{CLEAR_VARIABLE turn_number}                        ### change turn number when gomdring is found
	{CLEAR_VARIABLE hint}                               ### for message when hidden entrance is found
	{CLEAR_VARIABLE hint_spoken}                        ### for don't capture allies villages message
	{CLEAR_VARIABLE moveto_count}                       ### to clear stay_inside_the_walls when Antar attacks
	{CLEAR_VARIABLE antar_in_the_mines}                 ### check if Antar is in the mine or not. needed for hint yes or no
	{CLEAR_VARIABLE clear_target_prisondoor}            ### to clear target prison-door
	{CLEAR_VARIABLE side_10_gold}                       ### fake gold side 10
	{CLEAR_VARIABLE Antars_men}                         ### stored Antars men from Dwarven Pass scenario
	{CLEAR_VARIABLE side_7_limited_recruits}            ### limit recruits macro
	{CLEAR_VARIABLE side_8_limited_recruits}            ### limit recruits macro
	{CLEAR_VARIABLE unit_count_1}                       ### hint if Antar is on turn 10 still outside the mines
	{CLEAR_VARIABLE unit_count_7_8}                     ### hint if Antar is on turn 10 still outside the mines
	{CLEAR_VARIABLE ugoshag_meet}                       ### for the case the dwarfs attack Ugoshag before side=1 has meet him
#enddef

### wizard_status 0 = wizard still in prison
### wizard_status 1 = wizard free
### wizard_status 2 = wizard dead

#define STAY_INSIDE_THE_WALLS
	[ai]
		turns=1-999
		[avoid]
			terrain=Hh,Hh^Y26,Hhd^Dr,Gs,Gd,Mm,Gg,Rb,Ds
		[/avoid]
		[and]
			[avoid]
				x=31-32, 36-40, 60-70, 60-70
				y= 9-10,  9-15, 01-12, 30-33
			[/avoid]
		[/and]
	[/ai]
#enddef

#define DWARV_BEHAVIOR
	aggression=0.75
	caution=0.25
	village_value=1.0
	passive_leader=no
	grouping=yes
#enddef

#define OBJECTIVES_NEW NEWOBJ
	[objectives]
		side=1
		[objective]
			description=_ "{NEWOBJ}"
			condition=win
		[/objective]
		[objective]
			description=_ "Death of Antar"
			condition=lose
		[/objective]
		[objective]
			description=_ "Death of Dagor"
			condition=lose
		[/objective]
		[objective]
			description=_ "Death of Gelphrad"
			condition=lose
		[/objective]
		[objective]
			description=_ "Death of Gomdring (The Leader of the Dwarves)"
			condition=lose
		[/objective]
		[objective]
			description=_ "Turns run out"
			condition=lose
			show_turn_counter=yes
		[/objective]

		note={EARLY_FINISH_BONUS_NOTE}+{NEW_GOLD_CARRYOVER_NOTE_40}
	[/objectives]
#enddef

#define VIPDEAD
	[remove_shroud]
		x,y=$x1,$y1
		radius=2
		side=1
	[/remove_shroud]
	{AAARG_ANIMATED}
#enddef

#define IF_HAVE_UNIT_GOTO_XY UNIT GOTO_X GOTO_Y
	[if]
		[have_unit]
			id={UNIT}
		[/have_unit]
		[then]
			[modify_unit]
				[filter]
					id={UNIT}
				[/filter]
				goto_x={GOTO_X}
				goto_y={GOTO_Y}
			[/modify_unit]
		[/then]
	[/if]
#enddef










[scenario]
	id="The_Dwarves"
	name= _ "The Dwarves"
	map_data="{~add-ons/Antar/maps/08_The_Dwarves.map}"

	{TURNS 28 26 24}

	victory_when_enemies_defeated="no"

	{DEFAULT_SCHEDULE}

	[time_area]
		x=1-70,7-70,17-70,27-70,37-70,43-70,45-70
		y=1-2,3-6,7-9,10-14,15-20,21-28,29-44
		{UNDERGROUND}
	[/time_area]
 
	next_scenario="Flight_Tunnel"

	{MOOD_EPIC}

	[side]
		{ANTAR_SIDE}
		recruit= Sergeant, Spearman, Bowman, Horseman, Heavy Infantryman, Cavalryman
		team_name=Antar
		gold=100
		fog=no
		shroud=yes
		{FLAG_VARIANT loyalist}
	[/side]

	{STARTING_VILLAGES 1 6}

	[side]
		type=Dwarvish Berserker
		id="Aigatsil"
		name= _ "Aigatsil"
		overlays="misc/leader-expendable.png"
		side=2
		color=ASoR__Steelblue
		facing=sw
		canrecruit=yes
		{STAY_INSIDE_THE_WALLS}
		[ai]
			{DWARV_BEHAVIOR}
		[/ai]
		recruit= Dwarvish Ulfserker, Dwarvish Fighter
		team_name=Antar,Gomdring
		user_team_name= _ "Dwarves (Ally)"
		gold=80
		income=0   #3
		{FLAG_VARIANT knalgan}
	[/side]

	{STARTING_VILLAGES 2 7}

	[side]
		type=Dwarvish Steelclad
		id="Nardris"
		name= _ "Nardris"
		overlays="misc/leader-expendable.png"
		side=3
		color=ASoR__Cornflowerblue
		facing=se
		canrecruit=yes
		{STAY_INSIDE_THE_WALLS}
		[ai]
			{DWARV_BEHAVIOR}
		[/ai]
		recruit= Dwarvish Fighter,Dwarvish Thunderer,Dwarvish Ulfserker,Dwarvish Scout
		team_name=Antar,Gomdring
		user_team_name= _ "Dwarves (Ally)"
		gold=80
		income=0   #5
		{FLAG_VARIANT knalgan}
	[/side]

	{STARTING_VILLAGES 3 7}


	[side]
		{GOMDRING_SIDE}
		side=4
		facing=sw
		recruit= Dwarvish Fighter, Dwarvish Thunderer, Dwarvish Guardsman, Dwarvish Scout, Dwarvish Ulfserker
		team_name=Antar,Gomdring
		{STAY_INSIDE_THE_WALLS}
#ifver WESNOTH_VERSION <= 1.11.6
		{MICRO_AI_MESSENGER_ESCORT}
#endif
		gold=10
		income=0
		{FLAG_VARIANT knalgan}
	[/side]

	{STARTING_VILLAGES 4 16}


	[side]
		type=Dwarvish Steelclad
		id="Ambergur"
		name= _ "Ambergur"
		overlays="misc/leader-expendable.png"
		side=5
		color=ASoR__Dodgerblue
		facing=s
		canrecruit=yes
		{STAY_INSIDE_THE_WALLS}
		recruit= Dwarvish Fighter,Dwarvish Thunderer,Dwarvish Ulfserker,Dwarvish Scout
		team_name=Antar,Gomdring
		user_team_name= _ "Dwarves (Ally)"
		[ai]
			{DWARV_BEHAVIOR}
#			{ASoR_AI_GOAL__TARGET_SIDE__SIDES_VALUE     10 90}
#			{ASoR_AI_GOAL__TARGET_SIDE__SIDES_VALUE    (7) 10}
#			{ASoR_AI_GOAL__TARGET_SIDE__SIDES_VALUE    (8)  0}
			{ASoR_AI_GOAL__PROTECT_UNIT__ID_RADIUS_VALUE Gomdring 10 10}
		[/ai]
#		{MICRO_AI_MESSENGER_ESCORT}
		gold=80
		income=0   #5
		{FLAG_VARIANT knalgan}
	[/side]

	{STARTING_VILLAGES 5 13}


	[side]
		type=Dwarvish Steelclad
		id="Noringgurt"
		name= _ "Noringgurt"
		overlays="misc/leader-expendable.png"
		side=6
		color=ASoR__Lightskyblue   # Navyblue
		facing=se
		canrecruit=yes
		{STAY_INSIDE_THE_WALLS}
#		[ai]
#			{DWARV_BEHAVIOR}
#		[/ai]
#		{MICRO_AI_MESSENGER_ESCORT}
		recruit= Dwarvish Fighter,Dwarvish Thunderer,Dwarvish Ulfserker,Dwarvish Scout
		team_name=Antar,Gomdring
		user_team_name= _ "Dwarves (Ally)"
		gold=80
		income=0   #3
		{FLAG_VARIANT knalgan}
	[/side]

	{STARTING_VILLAGES 6 8}



	[side]
		type=Death Knight
		id="Lord Menachem"
		name= _ "Lord Menachem"
		profile=portraits/undead/draug.png~FL()~RIGHT()
		side=7
		color=ASoR__Orchid
		canrecruit=yes
		recruit= Skeleton, Skeleton Archer, Revenant, Deathblade
		team_name=Mal Kazur
		user_team_name= _ "Undead (Enemy)"
		facing=nw
		controller=ai
		[ai]
			turns=1-17
			[avoid]
				x=1-9
				y=1-33
			[/avoid]
		[/ai]
		[ai]
			time_of_day=dawn,morning,afternoon
			caution=0.25
			aggression=0.75
			passive_leader=no
		[/ai]
		[ai]
			time_of_day=dusk,first_watch,second_watch
			caution=0.0
			aggression=1.0
			passive_leader=no
		[/ai]
		[ai]
			{ASoR_AI_GOAL__TARGET_ID_VALUE (Ambergur) 4}
			{ASoR_AI_GOAL__TARGET_ID_VALUE (Nardris)  1}
			{ASoR_AI_GOAL__TARGET_ID_VALUE (Antar)    1}
		[/ai]
		{FLAG_VARIANT ragged}
		{GOLD 170 190 210}
		{INCOME 17 19 22}
	[/side]

	{STARTING_VILLAGES 7 9}

	[side]
		type=Death Knight
		id="Lord Baruch"
		name= _ "Lord Baruch"
#		profile=portraits/undead/draug.png~RIGHT()
		side=8
		color=ASoR__Purple4
		canrecruit=yes
		recruit= Skeleton, Skeleton Archer, Revenant, Deathblade
		team_name=Mal Kazur
		user_team_name= _ "Undead (Enemy)"
		facing=nw
		controller=ai
		[ai]
			turns=1-17
			[avoid]
				x=1-11
				y=1-33
			[/avoid]
		[/ai]
		[ai]
			time_of_day=dawn,morning,afternoon
			caution=0.25
			aggression=0.75
			passive_leader=no
		[/ai]
		[ai]
			time_of_day=dusk,first_watch,second_watch
			caution=0.0
			aggression=1.0
			passive_leader=no
		[/ai]
		[ai]
			{ASoR_AI_GOAL__TARGET_ID_VALUE (Gomdring) 4}
			{ASoR_AI_GOAL__TARGET_ID_VALUE (Nardris)  1}
			{ASoR_AI_GOAL__TARGET_ID_VALUE (Antar)    1}
		[/ai]
		{FLAG_VARIANT ragged}
		{GOLD 170 190 210}
		{INCOME 17 19 22}
	[/side]

	{STARTING_VILLAGES 8 8}

	[side]
		side=9
		color=ASoR__Mediumorchid
		controller=ai
		no_leader=yes
		recruit= Walking Corpse, Soulless
		team_name=Mal Kazur,Prisondoor
		user_team_name= _ "Prisoner (Enemy)"
		facing=se
		controller=null
		[ai]
			caution=0.0
			aggression=1.0
		[/ai]
		[ai]
			{ASoR_AI_GOAL__TARGET_ID_VALUE (Gomdring) 10}
		[/ai]
		income=-2
		{FLAG_VARIANT ragged}
		{GOLD 100 120 150}
	[/side]

	[side]
		side=10
		color=purple
		controller=ai
		no_leader=yes
		user_team_name= _ "Undead (Enemy)"
		team_name=Mal Kazur
		[ai]
			aggression=1.0
			caution=0.0
			village_value=0.0
			[leader_goal]
				x,y=66,32
			[/leader_goal]
		[/ai]
#		{MICRO_AI_GUARDIAN}
		{FLAG_VARIANT ragged}
		{GOLD 1512 1404 1296}
	[/side]

	[side]
		side=11
		color=black
		controller=null
		no_leader=yes
		team_name=Antar,Gomdring,Prisondoor
		user_team_name= _ "Prisondoor"
		hidden=yes
	[/side]


#	{ASoR_LIMIT_CONTEMPORANEOUS_RECRUITS_DIFFICULTY_DEPENDANT (7,8)                  "Revenant" 2 2 2}                      ### replaced by recruit_per_turn macro
#	{ASoR_LIMIT_CONTEMPORANEOUS_RECRUITS_DIFFICULTY_DEPENDANT (7,8)                "Deathblade" 2 3 3}                      ### replaced by recruit_per_turn macro
	{ASoR_LIMIT_RECRUITS_DIFFICULTY_DEPENDANT (7)                                "Bone Shooter" 2 2 3}
	{ASoR_LIMIT_RECRUITS_DIFFICULTY_DEPENDANT (7)                                     "Banebow" 0 1 2}
	{ASoR_LIMIT_RECRUITS_DIFFICULTY_DEPENDANT (8)                                "Bone Shooter" 2 2 3}
	{ASoR_LIMIT_RECRUITS_DIFFICULTY_DEPENDANT (8)                                     "Banebow" 0 1 2}
	{ASoR_LIMIT_CONTEMPORANEOUS_RECRUITS_DIFFICULTY_DEPENDANT (9)                      "Wraith" 1 2 2}
	{ASoR_LIMIT_CONTEMPORANEOUS_RECRUITS_DIFFICULTY_DEPENDANT (9)                  "Nightgaunt" 1 2 2}
	{ASoR_LIMIT_CONTEMPORANEOUS_RECRUITS_DIFFICULTY_DEPENDANT (9)                      "Shadow" 1 2 2}
	{ASoR_LIMIT_CONTEMPORANEOUS_RECRUITS_DIFFICULTY_DEPENDANT (9)                     "Spectre" 1 2 2}

	{STORY_THE_DWARVES}





	[event]
		name=prestart

		[remove_shroud]
			side=1
			x,y=4,33
			radius=7
		[/remove_shroud]

		[unit]
			type=Prisondoor
			id=Prisondoor1
			name= _ "Prisondoor"
			side=11
			x,y=47,15
		[/unit]

		[unit]
			type=Prisondoor
			id=Prisondoor2
			name= _ "Prisondoor"
			side=11
			x,y=48,13
		[/unit]

		[unit]
			type=Noach_no_staff
			id=Noach
			name= _ "Noach"
			side=9
			canrecruit=yes
			x,y=46,12
			facing=se
		[/unit]

		[unit]
			type="Revenant Mage"
			id="Ugoshag"
			name= _ "Ugoshag"
			profile=portraits/Ugoshag.png
			side=10
			canrecruit=yes
			x,y=66,32
			facing=se
			moves=0
		[/unit]

		{ASoR_GENERIC_NAMED_LOYAL_GUARD_UNIT 4 "Dwarvish Sentinel" 57  3 (Balmor)  }       ### the throne room guards
		{ASoR_GENERIC_NAMED_LOYAL_GUARD_UNIT 4 "Dwarvish Sentinel" 59  3 (Angudus) }       ### the throne room guards
		{ASoR_GENERIC_NAMED_LOYAL_GUARD_UNIT 4 "Dwarvish Sentinel" 60  8 (Borudus) }       ### this throne room guard stops Antar
		{ASoR_GENERIC_NAMED_LOYAL_GUARD_UNIT 4 "Dwarvish Sentinel" 56  8 (Alantor) }       ### this throne room guard stops Antar

		{ASoR_GENERIC_NAMED_GUARD_UNIT 4 "Dwarvish Fighter"        48 16 (Aifried) }       ### the prison guards
		{ASoR_GENERIC_NAMED_GUARD_UNIT 4 "Dwarvish Fighter"        53 18 (Andobrur)}       ### the prison guards
		{ASoR_GENERIC_NAMED_GUARD_UNIT 4 "Dwarvish Stalwart"       47 19 (Beodor)  }       ### the prison guards
		{ASoR_GENERIC_NAMED_GUARD_UNIT 4 "Dwarvish Stalwart"       49 20 (Ferodur) }       ### the prison guards
		{ASoR_GENERIC_NAMED_GUARD_UNIT 4 "Dwarvish Stalwart"       53 25 (Narfus)  }       ### the prison guards
		{ASoR_GENERIC_NAMED_GUARD_UNIT 4 "Dwarvish Runesmith"      47 16 (Brumdrus)}       ### the prison guards

		{ASoR_GENERIC_NAMED_GUARD_UNIT 4 "Dwarvish Runemaster"     65 22 (Beomir)  }       ### this guy guards Noringurt

		{GENERIC_UNIT 7 "Skeleton Archer"       17 13}                                     ### the starting attackers
		{GENERIC_UNIT 7 "Skeleton Archer"       16 12}                                     ### the starting attackers
		{GENERIC_UNIT 7 "Skeleton"              19 13}                                     ### the starting attackers
		{GENERIC_UNIT 7 "Revenant"              18 18} {GUARDIAN}                          ### the starting attackers
		{GENERIC_UNIT 7 "Skeleton"              19 23} {GUARDIAN}                          ### the starting attackers

		{GENERIC_UNIT 8 "Skeleton"              35 28}                                     ### the starting attackers
		{GENERIC_UNIT 8 "Revenant"              37 30}                                     ### the starting attackers
		{GENERIC_UNIT 8 "Revenant"              37 33}                                     ### the starting attackers

		{GENERIC_UNIT (10) (Draug)        65 33}                                           ### Ugoshag's guard
		[+unit]
			facing=sw
			ai_special=guardian
			id=draug_1
			max_moves=3
			max_hitpoints=78
		[/unit]
#		[micro_ai]
#			side="10"
#			ai_type=stationed_guardian
#			action=add
#			id=draug_1
#			distance=4
#			station_x,station_y=65,33
#			guard_x,guard_y=65,33
#		[/micro_ai]
		{GENERIC_UNIT (10) (Draug)        67 33}                                           ### Ugoshag's guard
		[+unit]
			facing=sw
			ai_special=guardian
			id=draug_2
			max_moves=3
			max_hitpoints=78
		[/unit]
#		[micro_ai]
#			side="10"
#			ai_type=stationed_guardian
#			action=add
#			id=draug_2
#			distance=4
#			station_x,station_y=67,33
#			guard_x,guard_y=67,33
#		[/micro_ai]


		{ASoR_SCENERY ground-skeleton.png        48 11}
		{ASoR_SCENERY coal.png                   31  9}
		{ASoR_SCENERY coal.png                   41  2}
		{ASoR_SCENERY coal.png                   45  2}
		{PLACE_IMAGE items/bones.png             54 14}
		{PLACE_IMAGE scenery/gate-rusty-se.png   48 13}
		{PLACE_IMAGE scenery/gate-rusty-sw.png   47 15}
		{ASoR_SCENERY noachs_staff.png           53 14}


		[remove_shroud]
			x,y=6,27
			radius=4
			side=1
		[/remove_shroud]
		[remove_shroud]
			x,y=3,33
			radius=5
			side=1
		[/remove_shroud]

		[capture_village]
			x,y=28,20
			side=8
		[/capture_village]

		{FOREACH Antars_men i}
			{VARIABLE Antars_men[$i].moves $Antars_men[$i].max_moves}
			{VARIABLE Antars_men[$i].hitpoints $Antars_men[$i].max_hitpoints}
			{VARIABLE Antars_men[$i].status.poisoned no}
			{VARIABLE Antars_men[$i].status.slowed no}
			{VARIABLE Antars_men[$i].attacks_left $Antars_men[$i].max_attacks}
			[unstore_unit]
				variable=Antars_men[$i]
				x,y=3,25
				find_vacant=yes
				fire_event=yes
			[/unstore_unit]
			[modify_unit]
				[filter]
					variable=Antars_men[$i]
				[/filter]
				facing=ne
			[/modify_unit]
			{VARIABLE_OP count_Antars_men add 1}
		{NEXT i}
		{CLEAR_VARIABLE Antars_men}


		{OBJECTIVES_NEW (Find The Dwarves)}

		{ASoR_HOLY_AMULET 1    34 18}

		{THE_USUAL_ASoR_MACROS}

		{ASoR__KILL_REMAINING_UNDEAD_AND_RISE_AGAIN  7}
		{ASoR__KILL_REMAINING_UNDEAD_AND_RISE_AGAIN  8}

		{ASoR__RECRUIT_PER_TURN 7 (Deathblade)       1}
		{ASoR__RECRUIT_PER_TURN 7 (Revenant)         1}
		{ASoR__RECRUIT_PER_TURN 7 (Skeleton Archer)  3}
		{ASoR__RECRUIT_PER_TURN 7 (Skeleton)         2}

		{ASoR__RECRUIT_PER_TURN 2 (Dwarvish Fighter) 1}

		{ASoR__RECRUIT_PER_TURN 8 (Deathblade)       2}
		{ASoR__RECRUIT_PER_TURN 8 (Revenant)         1}
		{ASoR__RECRUIT_PER_TURN 8 (Skeleton Archer)  1}
		{ASoR__RECRUIT_PER_TURN 8 (Skeleton)         2}

		{INITIALIZE_SCENARIO_VARIABLES}

		{MODIFY_UNIT (id="Gomdring")   facing sw}
		{MODIFY_UNIT (id="Nardris")    facing sw}
		{MODIFY_UNIT (id="Ambergur")   facing sw}
		{MODIFY_UNIT (id="Noringgurt") facing sw}

		{ASoR_TEMP_HELP ASoR_TH-8-01}
	[/event]


	[event]
		name=side 4 turn
		first_time_only=no
		[filter_condition]
			[variable]
				name=undead_meet
				numerical_equals=1
			[/variable]
		[/filter_condition]
		[remove_shroud]
			side=1
			[filter]
				side=7
			[/filter]
			radius=1
		[/remove_shroud]
		[remove_shroud]
			side=1
			[filter]
				side=8
			[/filter]
			radius=1
		[/remove_shroud]
	[/event]


		######################################################################
		### create some random undead each turn until Antar meets Gomdring ###
		######################################################################

	[event]
		name=new turn
		first_time_only=no
		[filter_condition]
			[variable]
				name=generator_on
				equals=yes
			[/variable]
		[/filter_condition]
		[if]
			[variable]
				name=wizard_status
				numerical_equals=0
			[/variable]
			[then]
#ifdef EASY
				{RANDOM (Skeleton Archer, Skeleton, Revenant, Deathblade, Deathblade)}
#endif
#ifdef NORMAL
				{RANDOM (Skeleton Archer, Bone Shooter, Revenant, Deathblade, Deathblade)}
#endif
#ifdef HARD
				{RANDOM (Bone Shooter,Revenant,Deathblade,Deathblade)}
#endif
				[unit]
					type=$random
					side=10
					x,y=66,33
					goto_x=48
					goto_y=11
				[/unit]
				{CLEAR_VARIABLE random}
			[/then]
			[else]
#ifdef EASY
				{RANDOM (Skeleton Archer, Skeleton, Revenant, Deathblade, Deathblade)}
#endif
#ifdef NORMAL
				{RANDOM (Skeleton Archer, Skeleton Archer, Bone Shooter, Bone Shooter, Revenant, Deathblade, Deathblade)}
#endif
#ifdef HARD
				{RANDOM (Bone Shooter,Revenant,Deathblade,Deathblade)}
#endif
				[unit]
					type=$random
					side=10
					x,y=66,33
				[/unit]
				{CLEAR_VARIABLE random}
			[/else]
		[/if]

		{RANDOM (Skeleton,Skeleton Archer,Bone Shooter,Skeleton,Skeleton Archer,Revenant,Skeleton,Skeleton Archer,Deathblade,Soulless,Skeleton,Skeleton Archer,Death Squire)}
		[unit]
			type=$random
			side=10
			x,y=68,33
		[/unit]
		{CLEAR_VARIABLE random}

		{RANDOM (0,0,0,1,1)}
		[if]
			[variable]
				name=random
				equals=1
			[/variable]
			[then]
				[unit]
					type="Walking Corpse"
					variation=dwarf
					side=10
					x,y=70,33
				[/unit]
			[/then]
		[/if]
		{CLEAR_VARIABLE random}

		[store_gold]
			side=10
			variable=side_10_gold
		[/store_gold]
		{VARIABLE_OP side_10_gold sub 18}
	[/event]

	[event]
		name=side 10 turn refresh
		first_time_only=no
		[filter_condition]
			[have_unit]
				side=1
				[filter_location]
					[filter]
						id=draug_1, draug_2
					[/filter]
					radius=8   #7
				[/filter_location]
				count=0
			[/have_unit]
		[/filter_condition]
		# keep Ugoshag from moving
		[modify_unit]
			[filter]
				id="Ugoshag"
			[/filter]
			moves=0
		[/modify_unit]
		# keep the guards back / workaround for return guardian
		{IF_HAVE_UNIT_GOTO_XY draug_1 65 33}
		{IF_HAVE_UNIT_GOTO_XY draug_2 67 33}
	[/event]

	### force side 2 to recruit some Ulfserkers first
	[event]
		name=turn 3
		[allow_recruit]
			side=2
			type=Dwarvish Fighter,Dwarvish Thunderer,Dwarvish Scout
		[/allow_recruit]
	[/event]


		############################################
		#### message when Antar meets the undead ###
		############################################

	{ASoR_ON_SIGHTING (undead) 1 (side=7,8,9) (
		[message]
			speaker=unit
			message= _ "Undead."
		[/message]
		{CUE_BATTLE}
		[remove_shroud]
			x,y=$x2,$y2
			radius=2
			side=1
		[/remove_shroud]
		[message]
			speaker=second_unit
			message= _ "The Dwarves are getting assistance."
		[/message]
		[remove_shroud]
			x,y=17,23
			radius=7
			side=1
		[/remove_shroud]
		[remove_shroud]
			x,y=12,30
			radius=7
			side=1
		[/remove_shroud]
		[message]
			speaker="Lord Menachem"
			message= _ "No matter.
Just kill them and bring me their heads!"
		[/message]
		{ASoR_DELAY 200}
		{ASoR_REMOVE_SHROUD_SCROLLTO 21 31 7 1}
		[message]
			speaker="Lord Baruch"
			message= _ "They will die, just like those ugly tiny little Dwarves, ha ha ha."
		[/message]
	)}


		#########################################################################
		#### give a hint about the hidden entrance when Antars forces to week ###
		#########################################################################

		#### set a variable when Antar steps on cave floor

	[event]
		name=moveto
		[filter]
			id="Antar"
			[filter_location]
				terrain=U*
			[/filter_location]
		[/filter]
		{VARIABLE_OP antar_in_the_mines value yes}
	[/event]

#	[event]
#		name=moveto
#		[filter]
#			id="Antar"
#			[filter_location]
#				terrain=Cud
#			[/filter_location]
#		[/filter]
#		{VARIABLE_OP antar_in_the_mines value yes}
#	[/event]


	[event]
		name=moveto
		[filter]
			id="Antar"
			[filter_location]
				terrain=Kud, Cud
			[/filter_location]
		[/filter]
		{VARIABLE_OP antar_in_the_mines value yes}
		{CUE_DWARVEN_CITY}
	[/event]

	[event]
		name=attack end
		first_time_only=no
		[filter]
			side=7
		[/filter]
		[filter_second]
			side=1
		[/filter_second]
		[filter_condition]
			[variable]
				name=count_Antars_men
				less_than=14
			[/variable]
			[variable]
				name=hidden_entrance_found
				equals=no
			[/variable]
			[variable]
				name=turn_number
				greater_than=5
			[/variable]
			[variable]
				name=hint
				equals=no
			[/variable]
			[variable]
				name=antar_in_the_mines
				equals=no
			[/variable]
		[/filter_condition]
		### count side 1 + 2 + 3
		[store_unit]
			[filter]
				side=1,2,3
				[not]
					x,y=recall,recall
				[/not]
			[/filter]
			variable=unit_count_1
			kill=no
		[/store_unit]
		[unstore_unit]
			variable=unit_count_1
			fire_event=yes
		[/unstore_unit]
		### count undead (7 + 8)
		[store_unit]
			[filter]
				side=7,8
			[/filter]
			variable=unit_count_7_8
			kill=no
		[/store_unit]
		[unstore_unit]
			variable=unit_count_1
			fire_event=yes
		[/unstore_unit]
		[if]
			[variable]
				name=unit_count_7_8.length
				greater_than=$unit_count_1.length
			[/variable]
			[then]
				[if]
					[have_unit]
						[not]
							id="Lord Menachem"
						[/not]
					[/have_unit]
					[then]
						[if]
							[have_unit]
								id=Garulf
							[/have_unit]
							[then]
								[message]
									speaker="Garulf"
									message= _ "The Undead forces seem to be superior. There is rumour of a hidden entrance to the mines in the north-east."
								[/message]
								[message]
									speaker="Garulf"
									message= _ "*to Lord Antar*   My Lord, you should try to find the entrance while we try to fight the enemy here."
								[/message]
							[/then]
							[else]
								[role]
									role=dwarf_survivor_or_dagor
									id=Grimbold,Toughkon,Dunamus,Dunamil,Dorobald,Dagor
								[/role]
								[message]
									role=dwarf_survivor_or_dagor
									message= _ "The Undead forces seem to be superior. There is rumour of a hidden entrance to the mines in the north-east."
								[/message]
								[message]
									role=dwarf_survivor_or_dagor
									message= _ "*to Lord Antar*   My Lord, you should try to find the entrance while we try to fight the enemy here."
								[/message]
							[/else]
						[/if]
						{VARIABLE_OP hint value yes}
					[/then]
				[/if]
			[/then]
		[/if]
		{CLEAR_VARIABLE unit_count_1}
		{CLEAR_VARIABLE unit_count_7_8}
		{CLEAR_VARIABLE count_Antars_men}
	[/event]

		##############################################################################
		#### give a hint when Antar spends to much time fighting outside the mines ###
		##############################################################################

	[event]
		name=turn 10
		[filter_condition]
			[variable]
				name=antar_in_the_mines
				equals=no
			[/variable]
		[/filter_condition]
		[message]
			speaker="Dagor"
			message= _ "*to Lord Antar* My Lord, you should hurry to meet the Dwarves leader."
		[/message]
#ifdef EASY
		{ASoR_NARRATOR (You loose the game if Lord Antar don't reach the Dwarv leader before turns runs out!)}
#endif
	[/event]


		###############################################
		#### end stay inside the wall for this side ###
		###############################################

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			[filter_location]
				x,y=20,18
				radius=5
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=moveto_count
				less_than=4
			[/variable]
		[/filter_condition]
		{VARIABLE_OP moveto_count add 1}

		### nested event
		[event]
			name=moveto
			first_time_only=no
			[filter]
				side=1
				[filter_location]
					x,y=20,18
					radius=5
				[/filter_location]
			[/filter]
			[filter_condition]
				[variable]
					name=moveto_count
					numerical_equals=4
				[/variable]
			[/filter_condition]
			[modify_side]
				side=2
				[ai]
					[avoid]
						terrain=Ds
					[/avoid]
					[and]
						[avoid]
							x=36-40
							y= 9-15
						[/avoid]
					[/and]
				[/ai]
			[/modify_side]
			# test / Ambergur
#			[modify_side]
#				side=5
#				[ai]
#					[avoid]
#						terrain=Ds
#					[/avoid]
#					[and]
#						[avoid]
#							x=36-40
#							y= 9-15
#						[/avoid]
#					[/and]
#				[/ai]
#			[/modify_side]
	#				[if]
	#					[variable]
	#						name=hint
	#						equals=no
	#					[/variable]
	#					[variable]
	#						name=hidden_entrance_found
	#						equals=no
	#					[/variable]
	#					[variable]
	#						name=antar_in_the_mines
	#						equals=no
	#					[/variable]
	#					[then]
	#						[message]
	#							speaker="Aigatsil"
	#							message= _ "The Undead forces seem to be superior. To the north-east is a hidden entrance to the mines."
	#						[/message]
	#					[/then]
	#				[/if]
		[/event]
	[/event]

	[event]
		name=moveto
		[filter]
#			id="Aigatsil"
			side=2
			[filter_location]
				terrain=G*
			[/filter_location]
		[/filter]
		[filter_condition]
			[have_unit]
				side=2
				count=3-999
			[/have_unit]
		[/filter_condition]
		[message]
			speaker="Aigatsil", $unit
			message= _ "Lets make a sally! Crush these boneheads to the ground."
		[/message]
	[/event]


#ifdef UNUSED

		#####################################
		### don't capture allies villages ###
		#####################################

	[event]
		name=capture
		first_time_only=no
		[filter]
			side=1
		[/filter]
		[filter_condition]
			[variable]
				name=hint_spoken
				equals=no
			[/variable]
		[/filter_condition]
		[if]
			[variable]
				name=owner_side
				greater_than=1
			[/variable]
			[variable]
				name=owner_side
				less_than=7
			[/variable]
			[then]
				[if]
					[variable]
						name=unit.id
						equals=Dagor
					[/variable]
					[then]
						[message]
							speaker="Antar"
							message=_ "Don't capture the dwarvish villages. That's not a good idea if we want to ask the Dwarves for their help."
						[/message]
					[/then]
					[else]
						[message]
							speaker="Dagor"
							message=_ "Don't capture the dwarvish villages. That's not a good idea if we want to ask the Dwarves for their help."
						[/message]
					[/else]
				[/if]
				{VARIABLE_OP hint_spoken value yes}
			[/then]
			[else]
				### what if?
			[/else]
		[/if]
	[/event]

#endif


		################################################################
		#### message and new objectives when Antar meets the dwarves ###
		################################################################

	{ASoR_ON_SIGHTING (dwarves) 1 side=2,3,4,5,6 (
		[remove_shroud]
			x,y=$x2,$y2
			radius=2
			side=1
		[/remove_shroud]
		[scroll_to]
			x=$x2
			y=$y2
		[/scroll_to]
		[if]
			[variable]
				name=unit.race
				equals=dwarf
			[/variable]
			[then]
				[message]
					speaker=unit
					message= _ "Hey $second_unit.name!"
				[/message]
				[message]
					speaker=second_unit
					message= _ "$unit.name you are allied with the Humans?"
				[/message]
				[message]
					speaker=unit
					message= _ "They are friends. They want to meet our leader."
				[/message]
			[/then]
			[else]
				[message]
					speaker=second_unit
					message= _ "Hey, there are Humans!"
				[/message]
				[message]
					speaker=unit
					message= _ "We found them!
We’re here to speak with your leader."
				[/message]
				[message]
					speaker=second_unit
					message= _ "If you want to fight with us, you are welcome!"
				[/message]
				[message]
					speaker=unit
					message= _ ""
				[/message]
			[/else]
		[/if]
		[message]
			speaker=second_unit
			message= _ "Our leader Gomdring is busy!  He crushes bones inside our mines. The Undead attacked us, they come from all sides. You will have to fight your way to meet him."
		[/message]
		[remove_shroud]
			terrain=Gg,Gd,Gg^Es,Gll^Fp,Aa,Hhd^Vhhr
			[not]
				x=1-10
			[/not]
			radius=1
			side=1
		[/remove_shroud]
		[remove_shroud]
			x,y=38,28
			radius=7
			side=1
		[/remove_shroud]
		[remove_shroud]
			x,y=30,22
			radius=5
			side=1
		[/remove_shroud]

		{OBJECTIVES_NEW (Find Gomdring, and move Antar to meet him)}

		{VARIABLE_OP undead_meet add 1}

		### update help menu
		{ASoR_TEMP_HELP ASoR_TH-8-02}
	)}


		########################################################
		#### when some unit discoverers the main evil leader ###
		########################################################

	{ASoR_ON_SIGHTING (undead_main_leader) (1) (id="Ugoshag") (
		[message]
			speaker=unit
			message= _ "This one seems to be their leader."
		[/message]
		{ASoR_REMOVE_SHROUD_SCROLLTO 66 32 3 1}
		[if]
			[have_unit]
				side=10
				count=8-999
			[/have_unit]
			[then]
				[message]
					speaker="Ugoshag"
					message= _ "I am Ugoshag. I am Mal Kazurs herald. Face your destiny, prepare to die."
				[/message]
			[/then]
			[else]
				[message]
					speaker="Ugoshag"
					message= _ "This isn't going like the master has planned."
				[/message]
			[/else]
		[/if]
		[message]
			speaker="Ugoshag"
			message= _ "I finally call my pets, hahaha.
*calls his pets*
Come to me my pets. Get yourself fresh meat.
*speaks to $unit.name*
My pets have hungered for a very long time,
now they will rip the flesh from your bones, hahah."
		[/message]

		{ASoR_PHONO old_one/caryn-die.ogg}
		{GENERIC_UNIT (10) (Deathhowler) 70 33}
		[+unit]
			facing=sw
			id=howler1
		[/unit]
		[move_unit]
			id=howler1
			to_x=69,68,67,66,65
			to_y=33,32,32,31,32
		[/move_unit]
		{ASoR_PHONO old_one/caryn-die.ogg}
		{GENERIC_UNIT (10) (Deathhowler)  70 33}
		[+unit]
			facing=sw
			id=howler2
		[/unit]
		[move_unit]
			id=howler2
			to_x=69,68,67,66
			to_y=33,32,32,31
		[/move_unit]
		{VARIABLE_OP ugoshag_meet value yes}
		### nested event
		[event]
			name=new turn
			{ASoR_PHONO old_one/caryn-die.ogg}
			{GENERIC_UNIT (10) (Deathhowler) 70 33}
			[+unit]
				facing=sw
				id=howler3
			[/unit]
			[move_unit]
				id=howler3
				to_x=69,68,67,66,65
				to_y=33,32,32,31,32
			[/move_unit]
			{ASoR_PHONO old_one/caryn-die.ogg}
			{GENERIC_UNIT (10) (Deathhowler)  70 33}
			[+unit]
				facing=sw
				id=howler4
			[/unit]
			[move_unit]
				id=howler4
				to_x=69,68,67,66
				to_y=33,32,32,31
			[/move_unit]
			### nested 2 event
			[event]
				name=new turn
				{ASoR_PHONO old_one/caryn-die.ogg}
				{GENERIC_UNIT (10) (Deathhowler) 70 33}
				[+unit]
					facing=sw
					id=howler5
				[/unit]
				[move_unit]
					id=howler5
					to_x=69,68,67,66,65
					to_y=33,32,32,31,32
				[/move_unit]
				{ASoR_PHONO old_one/caryn-die.ogg}
				{GENERIC_UNIT (10) (Deathhowler)  70 33}
				[+unit]
					facing=sw
					id=howler6
				[/unit]
				[move_unit]
					id=howler6
					to_x=69,68,67,66
					to_y=33,32,32,31
				[/move_unit]
			[/event]
		[/event]
	)}


		#############################
		### Ugoshag gets attacked ###
		#############################

	[event]
		name=attack_end
		first_time_only=no
		[filter_second]
			id=Ugoshag
		[/filter_second]
		[if]
			[variable]
				name=second_unit.hitpoints
				greater_than=25
			[/variable]
			[then]
				[message]
					speaker=Ugoshag
					message= _ "By the masters might, you shall die!"
				[/message]
			[/then]
			[else]
				[message]
					speaker=Ugoshag
					message= _ "Uh, I better retreat!"
				[/message]
				{MOVE_UNIT id=Ugoshag 70 33}
				[kill]
					id=Ugoshag
					animate=no
				[/kill]
				{ASoR_DELAY 600}
				[kill]
					side=10
					animate=yes
				[/kill]
				[fire_event]
					name=victory
				[/fire_event]
			[/else]
		[/if]
	[/event]

	### this is for the case that the dwarves are to strong and reach Ugoshag before side=1 meet him
	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=2,3,4,5,6
			[filter_location]
				x,y=66,32
				radius=3
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=ugoshag_meet
				equals=no
			[/variable]
		[/filter_condition]
		{GENERIC_UNIT (10) "Bone Shooter"  65 32}
		{GENERIC_UNIT (10) "Bone Shooter"  67 32}
	[/event]


		########################################################
		#### when the good guys discover the hidden entrance ###
		########################################################

	[event]
		name=moveto
		[filter]
			side=1
			[filter_location]
				x,y=4,6
				radius=4
			[/filter_location]
		[/filter]
		[remove_shroud]
			x,y=4,6
			radius=4
			side=1
		[/remove_shroud]
		{ASoR_SCROLL_TO 4 4 300}
		[if]
			[variable]
				name=hint
				equals=no
			[/variable]
			[then]
				[message]
					speaker=unit
					message= _ "Huh, what is that? Looks like a hole in the rocks."
				[/message]
				[message]
					speaker=unit
					message= _ "Seems I found a secret entrance."
				[/message]
			[/then]
			[else]
				[message]
					speaker=unit
					message= _ "There, a hole in the rocks."
				[/message]
				[message]
					speaker=unit
					message= _ "Seems I found the secret entrance to the mines."
				[/message]
			[/else]
		[/if]
		{VARIABLE_OP hidden_entrance_found value yes}
		{VARIABLE_OP hint                  value yes}
	[/event]


		#####################################################
		#### when the good guys discover the prison cells ###
		#####################################################

	[event]
		name=moveto
		[filter]
			side=1
			[filter_location]
				x,y=47,15
				radius=3
			[/filter_location]
		[/filter]
		[filter_condition]
			[have_unit]
				id="Prisondoor2"
			[/have_unit]
		[/filter_condition]
		[remove_shroud]
			x,y=47,15
			radius=4
			side=1
		[/remove_shroud]
		[message]
			speaker=unit
			message= _ "Uh, a prisoner?"
		[/message]
		[store_unit]
			[filter]
				side=2,3,4,5,6
				[filter_location]
					x,y=47,15
					radius=4
				[/filter_location]
			[/filter]
			variable=warden
			kill=no
		[/store_unit]
		[unstore_unit]
			variable=warden
			fire_event=yes
		[/unstore_unit]
		[message]
			speaker=$warden.id
			message= _ "Yes, a mighty dark sorcerer. The Undead want to free him.
Because of <i><b>him</b></i> we are in this trouble.
we would have done better to kill him, instead to bolt him in."
		[/message]
		[message]
			speaker="Noach"
			message= _ "Soon I will be free again, to take revenge!"
		[/message]
		[if]
			[variable]
				name=warden.type
				equals=Dwarvish Runesmith
			[/variable]
			[then]
				[message]
					speaker=$warden.id
					message= _ "*angry* Be quiet or you feel the cold steel of my hammer!"
				[/message]
			[/then]
			[else]
				[if]
					[variable]
						name=warden.type
						equals=Dwarvish Stalwart
					[/variable]
					[then]
						[message]
							speaker=$warden.id
							message= _ "*angry* Be quiet or you feel the cold steel of my javelin!"
						[/message]
					[/then]
					[else] # else means Fighter, Steelclad, or Lord
						[message]
							speaker=$warden.id
							message= _ "*angry* Be quiet or you feel the cold steel of my axe!"
						[/message]
					[/else]
				[/if]
			[/else]
		[/if]
		[message]
			speaker="Noach"
			message= _ "*spits out* Bah!"
		[/message]
		{CLEAR_VARIABLE warden}
	[/event]


		########################################################
		#### give gold to attackers when they about to loose ###
		########################################################

	[event]
		name=attack
		first_time_only=yes
		[filter]
			id="Lord Menachem"
		[/filter]
#ifdef EASY
		{ASoR_GOLD 7 40}
#endif
#ifdef NORMAL
		{ASoR_GOLD 7 60}
#endif
#ifdef HARD
		{ASoR_GOLD 7 80}
#endif
	[/event]

	[event]
		name=attack
		first_time_only=yes
		[filter]
			id="Lord Baruch"
		[/filter]
#ifdef EASY
		{ASoR_GOLD 8 40}
#endif
#ifdef NORMAL
		{ASoR_GOLD 8 60}
#endif
#ifdef HARD
		{ASoR_GOLD 8 80}
#endif
	[/event]


		############################################################
		#### give gold to attackers when they reach the 1st goal ###
		############################################################

	[event]
		name=moveto
		first_time_only=yes
		[filter]
			id="Lord Menachem"
			x,y=20,8
		[/filter]
#ifdef EASY
		{ASoR_GOLD 7 40}
#endif
#ifdef NORMAL
		{ASoR_GOLD 7 60}
#endif
#ifdef HARD
		{ASoR_GOLD 7 80}
#endif
	[/event]

	[event]
		name=moveto
		first_time_only=yes
		[filter]
			id="Lord Baruch"
			x,y=44,29
		[/filter]
#ifdef EASY
		{ASoR_GOLD 7 40}
#endif
#ifdef NORMAL
		{ASoR_GOLD 7 60}
#endif
#ifdef HARD
		{ASoR_GOLD 7 80}
#endif
	[/event]


		##################################
		#### when Antar meets Ambergur ###
		##################################

	[event]
		name=moveto
		[filter]
			id=Antar
			[filter_location]
				[filter]
					id=Ambergur
				[/filter]
				radius=6
			[/filter_location]
		[/filter]
		[message]
			speaker="Antar"
			message= _ "Hail Lord Dwarf, are you Gomdring?"
		[/message]
		[remove_shroud]
			[filter]
				id=Ambergur
			[/filter]
			radius=3
		[/remove_shroud]
		[scroll_to_unit]
			id=Ambergur
		[/scroll_to_unit]
		[message]
			speaker="Ambergur"
			message= _ "No, I am Ambergur!  You are looking for Gomdring? You will find him east of here in the throne-room."
		[/message]
	[/event]


		###################################
		#### when Side 1 meets Gomdring ###
		###################################

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			[filter_location]
				x,y=58,9
				radius=3
			[/filter_location]
		[/filter]
		[remove_shroud]
			x,y=58,5
			radius=10
			side=1
		[/remove_shroud]
		[store_unit]
			[filter]
				id=$unit.id
			[/filter]
			variable=gomdrings_visitor
			kill=no
		[/store_unit]
		[if]
			[variable]
				name=gomdrings_visitor.race
				equals=dwarf
			[/variable]
			[then]
				{ASoR_FIRE_EVENT visitor_dwarf}
			[/then]
			[else]
				[if]
					[variable]
						name=gomdrings_visitor.id
						equals="Antar"
					[/variable]
					[then]
						{ASoR_FIRE_EVENT visitor_antar}
					[/then]
					[else]
						{ASoR_FIRE_EVENT visitor_human}
					[/else]
				[/if]
			[/else]
		[/if]
	[/event]

		################################################
		#### Gomdring's visitor is not  equals Antar ###
		################################################

	[event]
		name=visitor_dwarf
		id=visitor_dwarf
		[if]
			[variable]
				name=gomdrings_visitor.id
				equals=Garulf
			[/variable]
			[then]
				[message]
					speaker="Gomdring"
					message= _ "Garulf my son. So you are back from your journey!"
				[/message]
				[message]
					speaker=Garulf
					message= _ "Yes father, I am back And right in time it seems
There are a lot of bone-heads around here.
We crushed many of them on our way to your throne room.

I have some humans with me.
Their leader is here because he needs a few dwarfs, with strong axes to support him in his upcoming fight."
				[/message]
				[message]
					speaker="Gomdring"
					message= _ "Then he should come to me."
				[/message]
			[/then]
			[else]
				[message]
					speaker="Gomdring"
					message= _ "$unit.name. So you are back from your journey!
Is my son Garulf with you?"
				[/message]
				[message]
					speaker=$unit.id
					message= _ "Yes he is, and healthy as well. We back And right in time it seems
There are a lot of bone-heads around here.
I've crushed many of them on my way to your throne-room.

I have some humans with me.
Their leader is here because he needs a few dwarfs, with strong axes to support him in his upcoming fight."
				[/message]
				[message]
					speaker="Gomdring"
					message= _ "Then he should come to me."
				[/message]
			[/else]
		[/if]
		{OBJECTIVES_NEW (Now move Antar in the throne-room to meet Gomdring)}
		{VARIABLE_OP gomdring_found value yes}
		{CLEAR_VARIABLE gomdrings_visitor}
		### now that a dwarf has met Gomdring the visitor_human-event useless and can be removed
		[event]
			id=visitor_human
			remove=yes
		[/event]
	[/event]

	[event]
		name=visitor_human
		id=visitor_human
		{VARIABLE temp_x1                 57}
		{VARIABLE temp_x2                 59}
		{VARIABLE temp_y $gomdrings_visitor.y}
		{VARIABLE_OP temp_y sub 1}
		[unstore_unit]
			variable=gomdrings_visitor
		[/unstore_unit]
		{MOVE_UNIT id=Alantor $temp_x1 $temp_y}
		{MOVE_UNIT id=Borudus $temp_x2 $temp_y}
		[message]
			speaker="Alantor"
			message= _ "Stop Human!"
		[/message]
		[message]
			speaker="Gomdring"
			message= _ "*to his guards* Let him pass."
		[/message]
		{MOVE_UNIT id=Alantor  56  8}
		{MOVE_UNIT id=Borudus  60  8}
		{MOVE_UNIT id=$unit.id 58  7}
		{MOVE_UNIT id=$unit.id 58  6}
		[message]
			speaker="Gomdring"
			message= _ "Who are you?"
		[/message]
		[message]
			speaker=$unit.id
			message= _ "I am a soldier of Lord Antar.  My Lord wishes to speak with you."
		[/message]
		[message]
			speaker="Gomdring"
			message= _ "Then he should come to me."
		[/message]
		{OBJECTIVES_NEW (Now move Antar in the throne-room to meet Gomdring)}
		{VARIABLE_OP gomdring_found value yes}
		{CLEAR_VARIABLE gomdrings_visitor}
		{CLEAR_VARIABLE temp_x1}
		{CLEAR_VARIABLE temp_x2}
		{CLEAR_VARIABLE temp_y}
		### now that a human has met Gomdring the visitor_dwarf-event useless and can be removed
		[event]
			id=visitor_dwarf
			remove=yes
		[/event]
	[/event]

		###########################################
		#### Gomdring's visitor is equals Antar ###
		###########################################

	[event]
		name=visitor_antar
		{VARIABLE temp_x1                 57}
		{VARIABLE temp_x2                 59}
		{VARIABLE temp_y $gomdrings_visitor.y}
		{VARIABLE_OP temp_y sub 1}
		[unstore_unit]
			variable=gomdrings_visitor
		[/unstore_unit]
		{MOVE_UNIT id=Alantor $temp_x1 $temp_y}
		{MOVE_UNIT id=Borudus $temp_x2 $temp_y}
		[message]
			speaker="Alantor"
			message= _ "Stop Human!"
		[/message]
		[if]
			[variable]
				name=gomdring_found
				equals=no
			[/variable]
			[then]
				[message]
					speaker="Gomdring"
					message= _ "Who are you?"
				[/message]
			[/then]
			[else]
				[message]
					speaker="Gomdring"
					message= _ "Oh, you must be the Human leader who wants to talk with me?"
				[/message]
				[message]
					speaker="Antar"
					message= _ "Yes I am."
				[/message]
				[message]
					speaker="Gomdring"
					message= _ "Your men fight well!  *<i>for Humans!</i>*"
				[/message]
			[/else]
		[/if]
		[message]
			speaker="Antar"
			message= _ "I am Antar, son of Lord Rheor. I am a friend in need."
		[/message]
		[message]
			speaker="Gomdring"
			message= _ "You are welcome, Human. But we are a little busy at the moment. The Undead are attacking us."
		[/message]
		{MOVE_UNIT id=Alantor  56  8}
		{MOVE_UNIT id=Borudus  60  8}
		{MOVE_UNIT id="Antar" 58  5}
		[message]
			speaker="Antar"
			message= _ "Why?"
		[/message]
		[if]
			[variable]
				name=wizard_status
				numerical_equals=0
			[/variable]
			[then]
				[message]
					speaker="Gomdring"
					message= _ "They want to free one of their masters who we have in prison here.  They are too many, we can hardly resist them.  We might need help."
				[/message]
				[message]
					speaker="Antar"
					message= _ "A sorcerer?"
				[/message]
				[message]
					speaker="Gomdring"
					message= _ "Yes, we tried to get information from him.  But before we could question him, we were attacked."
				[/message]

				### update help menu
				{ASoR_TEMP_HELP ASoR_TH-8-03}
			[/then]
		[/if]
		[if]
			[variable]
				name=wizard_status
				numerical_equals=1
			[/variable]
			[then]
				[message]
					speaker="Gomdring"
					message= _ "They have freed one of their masters who we had imprisoned here.  They were too many.  They freed him and now they want ho annihilate us. We might need help."
				[/message]
				[message]
					speaker="Antar"
					message= _ "A sorcerer?"
				[/message]
				[message]
					speaker="Gomdring"
					message= _ "Yes, we tried to get information from him. But before we he could question him, they attacked us and freed him."
				[/message]
				### update help menu
				{ASoR_TEMP_HELP ASoR_TH-8-04}
			[/then]
		[/if]
		[if]
			[variable]
				name=wizard_status
				numerical_equals=2
			[/variable]
			[then]
				[message]
					speaker="Gomdring"
					message= _ "They have freed one of their masters who we  had imprisoned here.  They were too many.  They freed him and now they want ho annihilate us. We might need help."
				[/message]
				[message]
					speaker="Antar"
					message= _ "A sorcerer?"
				[/message]
				[message]
					speaker="Gomdring"
					message= _ "Yes, we tried to get information from him.  But before we he could question him, they attacked us and freed him. But he is dead now."
				[/message]
				### update help menu
				{ASoR_TEMP_HELP ASoR_TH-8-04}
			[/then]
		[/if]
		[message]
			speaker="Antar"
			message= _ "Although we have come to ask for your help, we will help you."
		[/message]
		[message]
			speaker="Antar"
			message= _ "The evil will prevail if we do not stand together."
		[/message]
		{OBJECTIVES_NEW (Clear the mines. Defeat all enemies)}
		{VARIABLE_OP gomdring_found value yes}
		# set new turn limit
		[message]
			speaker=narrator
			message= _ "You have now $set_new_turns turns to clear the mines."
			image=wesnoth-icon.png
		[/message]
		{VARIABLE_OP set_new_turns add $turn_number}
		[modify_turns]
			value=$set_new_turns
		[/modify_turns]

		{CLEAR_GUARDIAN (Brumdrus) }
		{CLEAR_GUARDIAN (Narfus)   }
		{CLEAR_GUARDIAN (Ferodur)  }
		{CLEAR_GUARDIAN (Beomir)   }
		{CLEAR_GUARDIAN (Beodor)   }
		{CLEAR_GUARDIAN (Andobrur) }
		{CLEAR_GUARDIAN (Aifried)  }
		### now that Antar has met Gomdring the other both events are useless and should be removed
		[event]
			id=visitor_human
			remove=yes
		[/event]

		[event]
			id=visitor_dwarf
			remove=yes
		[/event]

		### nested event to let Gomdring start his attack run
		[event]
			name=new turn
			[event]
				name=new turn
				[event]
					name=new turn
					{ASoR_FIRE_EVENT gomdring_attack_run}
				[/event]
			[/event]
		[/event]

		### nested event for condition win
		[event]
			name=die
			first_time_only=no
			[filter_condition]
				[variable]
					name=gomdring_found
					equals=yes
				[/variable]
			[/filter_condition]
			[if]
				[variable]
					name=wizard_status
					greater_than=0   ### wizard is free or dead
				[/variable]
				[then]
					[if]
						[have_unit]
							side=7
							count=0
						[/have_unit]
						[have_unit]
							side=8
							count=0
						[/have_unit]
						[have_unit]
							side=9
							count=0
						[/have_unit]
						[not]
							[have_unit]
								id="Noach"
								side=9
							[/have_unit]
						[/not]
						[have_unit]
							side="10"
							count=0
						[/have_unit]
						[then]
							[message]
								speaker=second_unit
								message= _ "That was the last of the intruders!"
							[/message]
							[fire_event]
								name=victory
							[/fire_event]
						[/then]
					[/if]
				[/then]
				[else]
					[if]
						[have_unit]
							side=7
							count=0
						[/have_unit]
						[have_unit]
							side=8
							count=0
						[/have_unit]
						[have_unit]
							side=9
							count=1
						[/have_unit]
						[have_unit]
							side="10"
							count=0
						[/have_unit]
						[then]
							[kill]
								id="Noach"             ### needed to trigger 'enemies defeated'
								animate=no
							[/kill]
							{PLACE_IMAGE ("units/noach/noach_no_staff.png~RC(magenta>ASoR__Mediumorchid)")            46 12}
							[message]
								speaker=second_unit
								message= _ "That was the last of the intruders!"
							[/message]
							[fire_event]
								name=victory
							[/fire_event]
						[/then]
					[/if]
				[/else]
			[/if]
		[/event]
	[/event]


	##########################################################
	### this event should makes Gomdring attack the undead ###
	##########################################################

	[event]
		name=gomdring_attack_run
		first_time_only=yes
		# stop creating new undead for side 9
		{VARIABLE_OP generator_on value no}
		# do not longer recruit more dwarves
		[set_recruit]
			side=2
			recruit=""
		[/set_recruit]
		[set_recruit]
			side=3
			recruit=""
		[/set_recruit]
		[set_recruit]
			side=4
			recruit=""
		[/set_recruit]
		[set_recruit]
			side=5
			recruit=""
		[/set_recruit]
		[set_recruit]
			side=6
			recruit=""
		[/set_recruit]
		# start gomdrings attack run
		[micro_ai]
			side=4
			ai_type=messenger_escort
			action=add
			id=Gomdring
			waypoint_x=66,64,66
			waypoint_y=17,22,28
		[/micro_ai]

		### Release Gomdring when he has reached the goal
		[event]
			name=moveto
			[filter]
				id=Gomdring
				[filter_location]
					x,y=66,28
					radius=3
				[/filter_location]
			[/filter]
			[micro_ai]
				side=4
				ai_type=messenger_escort
				action=delete
#				id=Gomdring
#				waypoint_x=66,64,66
#				waypoint_y=17,22,28
			[/micro_ai]
		[/event]
	[/event]


		###########################################
		#### when someone finds the holy amulet ###
		###########################################

	[event]
		name=open_entrance
		{ASoR_NARRATOR (A former hidden entrance becomes visible.)}
		[terrain]
			x,y=34,17
			terrain=Hh
		[/terrain]
		[terrain]
			x,y=38,15
			terrain=Ur^Dr
		[/terrain]
		[redraw]
			clear_shroud=yes
			side=1
		[/redraw]
		[message]
			speaker=unit
			message= _ "Here is a half buried entrance!"
		[/message]
		[event]
			name=moveto
			[filter]
				side=1
				[filter_location]
					x=36,36,37,37,38
					y=15,11,15,16,15
					radius=1
				[/filter_location]
			[/filter]
			[message]
				speaker=unit
				message= _ "I am in a storage chamber! Look at all those drums."
			[/message]
		[/event]
	[/event]


		#############################################
		#### when Gomdring reaches the front line ###
		#############################################

	[event]
		name=attack end
		[filter]
			id=Gomdring
		[/filter]
		[message]
			speaker=Gomdring
			message= _ "Attack those Undead scum my Dwarvish brothers, let’s show the Humans how tough Dwarves can fight!"
		[/message]
		# nested event
		[event]
			name=attack end
			[filter_second]
				id=Gomdring
			[/filter_second]
			[message]
				speaker=Gomdring
				message= _ "I am Gomdring! Meet my axe, bonehead!"
			[/message]
			### nested event
			[event]
				name=die
				[filter_second]
					id=Gomdring
				[/filter_second]
				[message]
					speaker=Gomdring
					message= _ "Nobody annoys a Dwarf, take this!"
				[/message]
				### nested event
				[event]
					name=die
					[filter_second]
						id=Gomdring
					[/filter_second]
					[message]
						speaker=Gomdring
						message= _ "Another one is crushed to dust!"
					[/message]
					### nested event
					[event]
						name=die
						[filter_second]
							id=Gomdring
						[/filter_second]
						[message]
							speaker=Gomdring
							message= _ "Yeah, and better stay dead this time!"
						[/message]
					[/event]
				[/event]
			[/event]
		[/event]
	[/event]


		########################################
		#### the evil prisoner may get freed ###
		########################################

	[event]
		name=attack
		first_time_only=yes
		[filter_second]
			type=Prisondoor
		[/filter_second]
		[remove_shroud]
			x,y=$x1,$y1
			radius=6
			side=1
		[/remove_shroud]
		[message]
			speaker="Noach"
			message= _ "The hordes of the Master came to free me."
		[/message]
	[/event]

	[event]
		name=die
		[filter]
			id="Prisondoor1"
		[/filter]
		[terrain]
			terrain=Ur
			x,y=47,15
		[/terrain]
		[remove_item]
			x,y=47,15
		[/remove_item]
		[kill]
			x,y=$x1,$y1
			animate=yes
		[/kill]
#		{MOVE_UNIT id=Noach 47 13}
		[message]
			speaker="Noach"
			message= _ "My revenge is near. Hahahaha."
		[/message]
	[/event]

	[event]
		name=die
		[filter]
			id="Prisondoor2"
		[/filter]
		[terrain]
			terrain=Ur
			x,y=48,13
		[/terrain]
		[terrain]
			terrain=Uu
			x,y=47,13
		[/terrain]
		[remove_item]
			x,y=48,13
		[/remove_item]
		[kill]
			x,y=$x1,$y1
			animate=yes
		[/kill]
		{MOVE_UNIT id=Noach 48 13}
		[message]
			speaker="Noach"
			message= _ "I am free now. Hahahahah! Now you will feel my revenge, Dwarvish scum."
		[/message]
		[store_unit]
			[filter]
				side=2,3,4,5,6
				[filter_location]
					x,y=47,15
					radius=4
				[/filter_location]
			[/filter]
			variable=warden
			kill=no
		[/store_unit]
		[unstore_unit]
			variable=warden
		[/unstore_unit]
		[message]
			speaker=$warden.id
			message= _ "<b>The wizard is free!</b>"
		[/message]
		{CLEAR_VARIABLE warden}
		[modify_side]
			side=4
			{INCOME 13 17 19}
		[/modify_side]
		### activate the prisoner
		[modify_side]
			side=9
			controller=ai
		[/modify_side]
		### clear target prisondoor
		[store_unit]
			[filter]
				race=undead
			[/filter]
			variable=clear_target_prisondoor
			kill=no
		[/store_unit]
		[unstore_unit]
			variable=clear_target_prisondoor
		[/unstore_unit]
		{FOREACH clear_target_prisondoor i}
			[modify_unit]
				[filter]
					id=$clear_target_prisondoor[$i].id
				[/filter]
				goto_x=""
				goto_y=""
			[/modify_unit]
		{NEXT i}
		{CLEAR_VARIABLE clear_target_prisondoor}
		### set variable wizzard alive
		{VARIABLE_OP wizard_status add 1}
		### bring the wizard to his staff
		[terrain]
			x,y=52,13
			terrain=Ur
		[/terrain]
		[unit]
			type=Prisondoor
			id=Prisondoor3
			name= _ "Prisondoor"
			side=11
			x,y=52,13
		[/unit]
		{MOVE_UNIT id=Noach 51 13}
		[message]
			speaker="Noach"
			message= _ "First I need my staff."
		[/message]
		[animate_unit]
			[filter]
				id=Noach
			[/filter]
			flag=attack
			hits=yes
			with_bars=yes
			[primary_attack]
				name=chill wave
			[/primary_attack]
			[facing]
				[filter]
					x,y=52,13
				[/filter]
			[/facing]
		[/animate_unit]
		[kill]
			id=Prisondoor3
			animate=yes
		[/kill]
		{ASoR_REDRAW}
		{MOVE_UNIT id=Noach 53 14}
		{REMOVE_IMAGE 53 14}
		{TRANSFORM_UNIT id=Noach Necromancer}
		[message]
			speaker="Noach"
			message= _ "I have my staff back, now I am able to kill them all."
		[/message]
		{MOVE_UNIT id=Noach 51 13}
		### set a destination for the sorcerer
		[modify_unit]
			[filter]
				id="Noach"
			[/filter]
			goto_x=48
			goto_y=19
		[/modify_unit]

		### update help menu
		{ASoR_TEMP_HELP ASoR_TH-8-04}
		[allow_undo]
		[/allow_undo]
	[/event]

	[event]
		name=prerecruit
		[filter_second]
			id="Noach"
		[/filter_second]
		[message]
			speaker="Noach"
			message= _ "Here I can recall my Ghosts and Shadows, my Undead warriors. Now I will take my revenge. You will all die."
		[/message]
	[/event]


		###########################
		#### last breath events ###
		###########################

	[event]
		name=last breath                ###### set new target for dwarves when the eastern death knight dies
		first_time_only=no
		[filter]
			id="Lord Menachem"
		[/filter]
		[modify_side]
			side=2
			[ai]
				{ASoR_AI_GOAL__TARGET_SIDE__SIDES_VALUE 10 3}
			[/ai]
		[/modify_side]
		[modify_side]
			side=5
			[ai]
				{ASoR_AI_GOAL__TARGET_SIDE__SIDES_VALUE 10 9}
			[/ai]
		[/modify_side]
		[disallow_recruit]
			side=2
			type=Dwarvish Fighter,Dwarvish Thunderer,Dwarvish Ulfserker,Dwarvish Scout
		[/disallow_recruit]
		{CUE_TRIUMPH}
	[/event]

	[event]
		name=last breath                ###### set new target for dwarves when the western death knight dies
		first_time_only=no
		[filter]
			id="Lord Baruch"
		[/filter]
		[modify_side]
			side=3
			[ai]
				{ASoR_AI_GOAL__TARGET_SIDE__SIDES_VALUE 10 3}
			[/ai]
		[/modify_side]
		[modify_side]
			side=5
			[ai]
				{ASoR_AI_GOAL__TARGET_SIDE__SIDES_VALUE 10 9}
			[/ai]
		[/modify_side]
		[disallow_recruit]
			side=3
			type=Dwarvish Fighter,Dwarvish Thunderer,Dwarvish Ulfserker,Dwarvish Scout
		[/disallow_recruit]
		{CUE_TRIUMPH}
	[/event]

	[event]
		name=last breath
		first_time_only=no
		[filter]
			id="Ambergur"
		[/filter]
		{VIPDEAD}
	[/event]

	[event]
		name=last breath
		first_time_only=no
		[filter]
			id="Noringgurt"
		[/filter]
		{VIPDEAD}
	[/event]

	[event]
		name=last breath                ### when Gomdring dies the mission is failed
		[filter]
			id="Gomdring"
		[/filter]
		{VIPDEAD}
		[message]
			speaker="Gomdring"
			message= _ "Death has found me!"
		[/message]
		[message]
			speaker="Antar"
			message= _ "Without Gomdrings support we are lost."
		[/message]
		{DEFEAT}
	[/event]

	[event]
		name=last breath                ### defender of the northern gate
		[filter]
			id="Aigatsil"
		[/filter]
		{VIPDEAD}
		[if]
			[variable]
				name=wizard_status
				numerical_not_equals=1
			[/variable]
			[then]
				{ASoR_GOLD 5 40}
			[/then]
			[else]
				{ASoR_GOLD 5 90}
			[/else]
		[/if]
		[if]
			[have_unit]
				id="Lord Menachem"
			[/have_unit]
			[then]
				[modify_side]
					side=7
					[ai]
						[leader_goal]
							x,y=20,8
						[/leader_goal]
					[/ai]
				[/modify_side]
			[/then]
		[/if]
		[if]
			[have_unit]
				id="Ambergur"
			[/have_unit]
			[then]
				[modify_side]
					side=5
					[ai]
						[leader_goal]
							x,y=20,8
							max_risk=2
						[/leader_goal]
						leader_ignores_keep=yes
					[/ai]
				[/modify_side]
			[/then]
		[/if]
	[/event]

	[event]
		name=last breath                ### defender of the southern gate
		[filter]
			id="Nardris"
		[/filter]
		{VIPDEAD}
		[if]
			[variable]
				name=wizard_status
				numerical_not_equals=1
			[/variable]
			[then]
				{ASoR_GOLD 6 40}
			[/then]
			[else]
				{ASoR_GOLD 6 90}
			[/else]
		[/if]
		[if]
			[have_unit]
				id="Lord Baruch"
			[/have_unit]
			[then]
				[modify_side]
					side=8
					[ai]
						[leader_goal]
							x,y=44,29
						[/leader_goal]
					[/ai]
				[/modify_side]
			[/then]
		[/if]
		[if]
			[have_unit]
				id="Noringgurt"
			[/have_unit]
			[then]
				[modify_side]
					side=6
					[ai]
						[leader_goal]
							x,y=44,29
							max_risk=2
						[/leader_goal]
						leader_ignores_keep=yes
					[/ai]
				[/modify_side]
			[/then]
		[/if]
	[/event]

	[event]
		name=last breath                ### death of the prisoner
		[filter]
			id="Noach"
		[/filter]
		{VIPDEAD}
		{VARIABLE_OP wizard_status add 1}
	[/event]

	[event]
#		name=enemies defeated    ### triggers when all enemy with canrecruit=yes are killed, but we want to clear the mines from all undead
		name=victory
		[message]
			speaker="Antar"
			message= _ "The battle is won!"
		[/message]
		[message]
			speaker="Gomdring"
			message= _ "Yes, but they will seek revenge for this defeat!"
		[/message]

		{CUE_TRIUMPH}
		{ASoR_DELAY 800}

		[endlevel]
			result=victory
			bonus=yes
			{NEW_GOLD_CARRYOVER 40}
		[/endlevel]
	[/event]

	[event]
		name=victory
		{CLEAR_SCENARIO_VARIABLES}
	[/event]

	{~add-ons/Antar/utils/utils.cfg}
	{~add-ons/Antar/utils/deaths.cfg}
[/scenario]

#undef INITIALIZE_SCENARIO_VARIABLES
#undef CLEAR_SCENARIO_VARIABLES
#undef STAY_INSIDE_THE_WALLS
#undef DWARV_BEHAVIOR
#undef VIPDEAD
#undef OBJECTIVES_NEW NEWOBJ
#undef CLEAR_GUARDIAN ID
#undef IF_HAVE_UNIT_GOTO_XY UNIT GOTO_X GOTO_Y
#undefF UNDEAD_HALO NUMBER
